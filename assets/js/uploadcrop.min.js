$.fn.uploadCrop=function(e){function v(e){$(o).html("").append(u);$("#"+a).prop("src",e.target.result.toString()).hide();$(f).prop("disabled",false);$(l).prop("disabled",false);$(c).prop("disabled",false);$(h).prop("disabled",false);$("#"+a+"_button_accept").off("click");$("#"+a+"_button_cancel").off("click");$(p).off("shown.bs.modal");$("#"+a+"_button_accept").on("click",function(){var e=$("#"+a).cropper("getDataURL");if(e==""){var t=$("#"+a).cropper("getImageData");$(f).val("0");$(l).val(t.naturalWidth);$(c).val("0");$(h).val(t.naturalHeight);d.prop("src",$("#"+a).prop("src")).show()}else{d.prop("src",e).show()}$(o).html("");$(p).modal("hide")});$("#"+a+"_button_cancel").on("click",function(){$(i).val("");d.hide();$(o).html("");$(f).val("");$(l).val("");$(c).val("");$(h).val("");$(f).prop("disabled",true);$(l).prop("disabled",true);$(c).prop("disabled",true);$(h).prop("disabled",true);$(p).modal("hide")});$(p).on("shown.bs.modal",function(e){if($(o).width()>$("#"+a).width()){$(o).css({width:$("#"+a).width()+"px"})}n["dragend"]=function(){var e=$(this).cropper("getData");$(f).val(e.x);$(l).val(e.width);$(c).val(e.y);$(h).val(e.height)};n["built"]=function(){$("#"+a).cropper("clear");$(p).modal("adjustBackdrop")};$("#"+a).cropper(n)});$(p).modal("show")}var t=e["inputField"];var n=e["jcropOptions"];var r=e["sizemax"];var i=$(this);var s=$(this).parents(".uploadcrop");var o=$(s).find("div#image-source");var u=$(o).find("img").prop("outerHTML");var a=$(o).find("img").attr("id");var f=$("#"+t+"-x");var l=$("#"+t+"-width");var c=$("#"+t+"-y");var h=$("#"+t+"-height");var p=$(s).find("div.modal");var d=$(s).find("#preview-pane div.preview-container img.preview_image");d.css("maxWidth",r+"px").css("maxHeight",r+"px").hide();i.change(function(e){var t=e.target.files[0],n=/image.*/;if(!t.type.match(n))return;var r=new FileReader;r.onload=v;r.readAsDataURL(t)})}